<div>
  <div class="d-flex justify-content-between">
    <form class="col-2" action="/requisition" method="get">
      <button type="submit" class="btn btn-outline-success">Voltar</button>
    </form>
    <form class="col-2" action="/requisition/delete/{{requisition._id}}" method="post">
      <button type="submit" class="btn btn-outline-danger">Apagar</button>
    </form>
  </div>

  <div class="edit-requisition">
    <hr color="lightgray">
    <div class="requisition-titles">
      <p> Dados de Cobrança</p>
    </div>
    </br>
  </div>

  <form action="/requisition/edit/{{requisition._id}}" id="reqEdit" method="post"
    class="d-flex flex-column align-items-center">
    <div id="keep-address" class="form-row col-md-10">
      <div class="requisition-text col-md-12">
        <input required id="fullname" type="text" name="requisition[client][fullname]"
          value="{{requisition.client.fullname}}" class="requisition-text" placeholder="Razão Social/Nome Completo">
      </div>
      <div class="requisition-text col-md-6">
        <input required id="cpf" type="text" name="requisition[client][register]"
          value="{{requisition.client.register}}" class="requisition-text" placeholder="CNPJ/CPF">
      </div>
      <div class="requisition-text col-md-6">
        <input required id="I.E" type="text" name="requisition[IE]" class="requisition-text" placeholder="I.E"
          value="{{requisition.IE}}">
      </div>
      <div class="requisition-text col-md-6">
        <input required id="street" type="text" name="requisition[address][street]"
          value="{{requisition.address.street}}" class="requisition-text" placeholder="Endereço de Faturamento">
      </div>
      <div class="requisition-text col-md-6">
        <input required id="number" type="text" name="requisition[address][number]"
          value="{{requisition.address.number}}" class="requisition-text" placeholder="Nº">
      </div>
      <div class="requisition-text col-md-6">
        <input id="complement" type="text" name="requisition[address][complement]"
          value="{{requisition.address.complement}}" class="requisition-text" placeholder="Complemento">
      </div>
      <div class="requisition-text col-md-6">
        <input required id="neighborhood" type="text" name="requisition[address][neighborhood]"
          value="{{requisition.address.neighborhood}}" class="requisition-text" placeholder="Bairro">
      </div>
      <div class="requisition-text col-md-4">
        <input required id="city" type="text" name="requisition[address][city]" value="{{requisition.address.city}}"
          class="requisition-text" placeholder="Cidade">
      </div>
      <div class="requisition-text col-md-4 d-flex align-items-center">
        <select id="userstate" class="drowdownoptions" name="requisition[address][state]" required="required">
          <option disabled selected value="">Estado</option>
          <option value="AC">Acre</option>
          <option value="AL">Alagoas</option>
          <option value="AP">Amapá</option>
          <option value="AM">Amazonas</option>
          <option value="BA">Bahia</option>
          <option value="CE">Ceará</option>
          <option value="DF">Distrito Federal</option>
          <option value="ES">Espirito Santo</option>
          <option value="GO">Goiás</option>
          <option value="MA">Maranhão</option>
          <option value="MS">Mato Grosso do Sul</option>
          <option value="MT">Mato Grosso</option>
          <option value="MG">Minas Gerais</option>
          <option value="PA">Pará</option>
          <option value="PB">Paraíba</option>
          <option value="PR">Paraná</option>
          <option value="PE">Pernambuco</option>
          <option value="PI">Piauí</option>
          <option value="RJ">Rio de Janeiro</option>
          <option value="RN">Rio Grande do Norte</option>
          <option value="RS">Rio Grande do Sul</option>
          <option value="RO">Rondônia</option>
          <option value="RR">Roraima</option>
          <option value="SC">Santa Catarina</option>
          <option value="SP">São Paulo</option>
          <option value="SE">Sergipe</option>
          <option value="TO">Tocantins</option>
        </select>
      </div>
      <div class="requisition-text col-md-4">
        <input required id="cep" type="number" name="requisition[address][cep]" value="{{requisition.address.cep}}"
          class="requisition-text" placeholder="CEP" title="Um CEP válido tem 8 caracteres!">
      </div>
      <div class="requisition-text col-md-12">
        <input required id="resposible" type="text" name="requisition[responsible]" class="requisition-text"
          placeholder="Responsável pela amostra" value="{{requisition.responsible}}">
      </div>
      <div class="requisition-text col-md-6">
        <input required id="phone" type="text" name="requisition[client][phone]" value="{{requisition.client.phone}}"
          class="requisition-text" placeholder="Tel. com DDD">
      </div>
      <div class=" requisition-text col-md-6">
        <input required id="cellphone" type="text" name="requisition[client][cellphone]"
          value="{{requisition.client.cellphone}}" class="requisition-text" placeholder="Cel. com DDD">
      </div>
      <div class="requisition-text col-md-12">
        <input required id="email" type="text" name="requisition[client][email]" value="{{requisition.client.email}}"
          class="requisition-text" placeholder="Email">
      </div>
    </div>
    <br>
    <div class="requisition-titles">
      <p> Requisição de Análise</p>
    </div>
    <br>
    <div class="form-row col-md-10">
      <div class="requisition-text col-md-6">
        <input required type="text" name="requisition[producer]" class="requisition-text"
          placeholder="Nome do cliente | Fazenda | Produtor" value="{{requisition.producer}}">
      </div>
      <div class="requisition-text col-md-6">
        <input type="text" name="requisition[autorizationnumber]" class="requisition-text"
          placeholder="Número de Autorização" value="{{requisition.autorizationnumber}}">
      </div>
      <div class="requisition-text col-md-6">
        <input required type="text" name="requisition[city]" class="requisition-text" placeholder="Município"
          value="{{requisition.city}}">
      </div>
      <div class="requisition-text col-md-6 d-flex align-items-center">
        <select id="requisitonstate" class="drowdownoptions" name="requisition[state]" required="required">
          <option disabled selected value="">Estado</option>
          <option value="AC">Acre</option>
          <option value="AL">Alagoas</option>
          <option value="AP">Amapá</option>
          <option value="AM">Amazonas</option>
          <option value="BA">Bahia</option>
          <option value="CE">Ceará</option>
          <option value="DF">Distrito Federal</option>
          <option value="ES">Espirito Santo</option>
          <option value="GO">Goiás</option>
          <option value="MA">Maranhão</option>
          <option value="MS">Mato Grosso do Sul</option>
          <option value="MT">Mato Grosso</option>
          <option value="MG">Minas Gerais</option>
          <option value="PA">Pará</option>
          <option value="PB">Paraíba</option>
          <option value="PR">Paraná</option>
          <option value="PE">Pernambuco</option>
          <option value="PI">Piauí</option>
          <option value="RJ">Rio de Janeiro</option>
          <option value="RN">Rio Grande do Norte</option>
          <option value="RS">Rio Grande do Sul</option>
          <option value="RO">Rondônia</option>
          <option value="RR">Roraima</option>
          <option value="SC">Santa Catarina</option>
          <option value="SP">São Paulo</option>
          <option value="SE">Sergipe</option>
          <option value="TO">Tocantins</option>
        </select>
      </div>
      <div class="requisition-text col-md-6">
        <input required type="text" name="requisition[datecollection]" class="requisition-text"
          placeholder="Data de Coleta (dd/mm/aaaa)" value="{{requisition.datecollection}}">
      </div>
      <div class="requisition-text col-md-6">
        <input required type="text" name="requisition[datereceipt]" class="requisition-text"
          placeholder="Data de Recebimento (dd/mm/aaaa)" value="{{requisition.datereceipt}}">
      </div>
    </div>

    <br>
    <h6 align="center"> Qual é a destinação do alimento?</h6>
    <br>

    <div class="form-group d-flex flex-wrap text-left justify-content-center">
      <div class="column">
        <div class="form-check">
          <input id="Aves" class="form-check-input destination" type="radio" name="requisition[destination]"
            value="Aves">
          <label for="Aves" class="radio-text form-check-label mr-3"> Aves </label>
        </div>

        <div class="form-check">
          <input id="Gado de Leite" class="form-check-input destination" type="radio" name="requisition[destination]"
            value="Gado de Leite">
          <label for="Gado de Leite" class="radio-text form-check-label mr-3"> Gado de Leite </label>
        </div>
      </div>

      <div class="column">
        <div class="form-check">
          <input id="Gado de Corte" class="form-check-input destination" type="radio" name="requisition[destination]"
            value="Gado de Corte">
          <label for="Gado de Corte" class="radio-text form-check-label mr-3"> Gado de Corte </label>
        </div>

        <div class="form-check">
          <input id="Suínos" class="form-check-input destination" type="radio" name="requisition[destination]"
            value="Suínos">
          <label for="Suínos" class="radio-text form-check-label mr-3"> Suínos </label>
        </div>
      </div>

      <div class="column">
        <div class="form-check">
          <input id="Equinos" class="form-check-input destination" type="radio" name="requisition[destination]"
            value="Equinos">
          <label for="Equinos" class="radio-text form-check-label mr-3"> Equinos </label>
        </div>

        <div class="form-check">
          <input id="Caprinos" class="form-check-input destination" type="radio" name="requisition[destination]"
            value="Caprinos">
          <label for="Caprinos" class="radio-text form-check-label mr-3"> Caprinos </label>
        </div>
      </div>

      <div class="column">
        <div class="form-check">
          <input id="Ovinos" class="form-check-input destination" type="radio" name="requisition[destination]"
            value="Ovinos">
          <label for="Ovinos" class="radio-text form-check-label mr-3"> Ovinos </label>
        </div>
        <div class="form-check">
          <input id="Peixes" class="form-check-input destination" type="radio" name="requisition[destination]"
            value="Peixes">
          <label for="Peixes" class="radio-text form-check-label mr-3"> Peixes </label>
        </div>
      </div>
      <div class="column">
        <div class="form-check">
          <input id="Pet" class="form-check-input destination" type="radio" name="requisition[destination]" value="Pet">
          <label for="Pet" class="radio-text form-check-label mr-3"> Pet </label>
        </div>

        <div class="form-check">
          <input id="Matéria-Prima" class="form-check-input destination" type="radio" name="requisition[destination]"
            value="Matéria-Prima">
          <label for="Matéria-Prima" class="radio-text form-check-label mr-3"> Matéria-Prima(Fábrica de
            Ração) </label>
        </div>
      </div>
      <div class="row ml-0">
        <div class="form-check">
          <input id="Outros" class="form-check-input destination" type="radio" name="requisition[destination]" value="">
          <label for="Outros" class="radio-text form-check-label mr-3"> Outros </label>
        </div>
        <div id="Other-destination" class="form-disabled form-row h-50">
          <input type="text" id="OtherInput" class="input w-100" placeholder="Destinação">
        </div>
      </div>
    </div>
    <br>
    <div class="requisition-titles">
      <p> Identificação da Amostra</p>
    </div>
    <div class="d-flex form-row col-md-10 justify-content-center">
      {{#each samples}}
        <div class="container-fluid card my-2 p-4">
          <div class="row">
            <div class="requisition-text col-md-10">
              <input required type="text" name="sample[{{@index}}][name]" class="requisition-text"
                placeholder="Nome da amostra" value="{{name}}">
            </div>
            <script>
              $(document).ready(function () {
                let reqtype = "{{sampletype}}";
                $('select#{{_id}}').val(reqtype);
              });
            </script>

            <div class="checkbox col-md-2 d-flex pb-1">
              <div class="align-self-end">
                <input type="checkbox" id="polpa{{@index}}" name="sample[{{@index}}][isCitrus]" value="true"
                  class="my-auto" {{#if isCitrus}}checked{{/if}} />
                <label for="polpa{{@index}}" class="">Contém polpa cítrica</label>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="requisition-text col-md-4 d-flex align-items-center">
              <input type="hidden" name="sample[{{@index}}][_id]" class="requisition-text" value="{{_id}}">
              <select id="{{_id}}" value="{{sampletype}}" class="drowdownoptions w-100"
                name="sample[{{@index}}][sampletype]" required="required">
                {{#each allSampleTypes}}
                  <option value="{{this}}">{{this}}</option>
                {{/each}}
              </select>
            </div>
            <div class="requisition-text col-md-3">
              <input required type="text" name="sample[{{@index}}][packingtype]" class="requisition-text"
                placeholder="Tipo de embalagem" value="{{packingtype}}">
            </div>
            <div class="requisition-text col-md-3">
              <input required type="text" name="sample[{{@index}}][receivedquantity]" class="requisition-text"
                placeholder="Quantidade recebida (g)" value="{{receivedquantity}}">
            </div>


          </div>
        </div>
      {{/each}}

      <div class="requisition-titles mt-3">
        <p> Análises Solicitadas</p>
      </div>

      <div class="d-flex flex-row flex-wrap justify-content-around w-100">
        <div class="d-flex mx-1">

          {{#if requisitionExtra.aflatoxina_hasResult}}
            <label class="radio-text form-check-label">
              <input type="checkbox" class="mr-1" disabled checked />Aflatoxinas</label>
            <input type="checkbox" class="d-none" name="requisition[mycotoxin]" id="Aflatoxinas" value="Aflatoxinas"
              checked />
          {{else}}
            <label class="radio-text form-check-label">
              <input type="checkbox" class="mr-1" name="requisition[mycotoxin]" id="Aflatoxinas"
                value="Aflatoxinas" />Aflatoxinas</label>
          {{/if}}
        </div>
        <div class="d-flex mx-1">
          {{#if requisitionExtra.deoxinivalenol_hasResult}}
            <label class="radio-text form-check-label">
              <input type="checkbox" class="mr-1" disabled checked />Deoxinivalenol*</label>
            <input type="checkbox" class="d-none" name="requisition[mycotoxin]" id="Deoxinivalenol"
              value="Deoxinivalenol" checked />
          {{else}}
            <label class="radio-text form-check-label">
              <input type="checkbox" class="mr-1" name="requisition[mycotoxin]" id="Deoxinivalenol"
                value="Deoxinivalenol" />Deoxinivalenol*</label>
          {{/if}}
        </div>
        <div class="d-flex mx-1">
          {{#if requisitionExtra.fumonisina_hasResult}}
            <label class="radio-text form-check-label">
              <input type="checkbox" class="mr-1" disabled checked />Fumonisinas</label>
            <input type="checkbox" class="d-none" name="requisition[mycotoxin]" id="Fumonisinas" value="Fumonisinas"
              checked />
          {{else}}
            <label class="radio-text form-check-label">
              <input type="checkbox" class="mr-1" name="requisition[mycotoxin]" id="Fumonisinas"
                value="Fumonisinas" />Fumonisinas</label>
          {{/if}}
        </div>
        <div class="d-flex mx-1">
          {{#if requisitionExtra.ocratoxina_hasResult}}
            <label class="radio-text form-check-label">
              <input type="checkbox" class="mr-1" disabled checked />Ocratoxina A</label>
            <input type="checkbox" class="d-none" name="requisition[mycotoxin]" id="Ocratoxina A" value="Ocratoxina A"
              checked />
          {{else}}
            <label class="radio-text form-check-label">
              <input type="checkbox" class="mr-1" name="requisition[mycotoxin]" id="Ocratoxina A"
                value="Ocratoxina A" />Ocratoxina A</label>
          {{/if}}
        </div>
        <div class="d-flex mx-1">
          {{#if requisitionExtra.t2toxina_hasResult}}
            <label class="radio-text form-check-label">
              <input type="checkbox" class="mr-1" disabled checked />T-2 toxina</label>
            <input type="checkbox" class="d-none" name="requisition[mycotoxin]" id="T-2 toxina" value="T-2 toxina"
              checked />
          {{else}}
            <label class="radio-text form-check-label">
              <input type="checkbox" class="mr-1" name="requisition[mycotoxin]" id="T-2 toxina" value="T-2 toxina" />T-2
              toxina</label>
          {{/if}}
        </div>
        <div class="d-flex mx-1">
          {{#if requisitionExtra.zearalenona_hasResult}}
            <label class="radio-text form-check-label">
              <input type="checkbox" class="mr-1" disabled checked />Zearalenona</label>
            <input type="checkbox" class="d-none" name="requisition[mycotoxin]" id="Zearalenona" value="Zearalenona"
              checked />
          {{else}}
            <label class="radio-text form-check-label">
              <input type="checkbox" class="mr-1" name="requisition[mycotoxin]" id="Zearalenona"
                value="Zearalenona" />Zearalenona</label>
          {{/if}}
        </div>
      </div>

      <script>
        $(document).ready(function () {
          const micotoxins = '{{requisition.mycotoxin}}'.split(',');

          micotoxins.forEach(toxin => {
            $(`input[id='${toxin}']`).prop("checked", true);
          })
        });
      </script>


    </div>
    <div class="requisition-text col-md-10 mt-5 mb-5">
      <textarea class="requisition-text w-100" name="requisition[comment]" placeholder="Observações"
        rows="4">{{requisition.comment}}</textarea>
    </div>
</div>

{{#if nova}}
  <input type="checkbox" style="display: none;" id="toApprove" name="toApprove" value="toApprove" />
{{else}}
  <input type="checkbox" style="display: none;" id="toApprove" name="toApprove" value="approved" checked />
{{/if}}
<div>
  <input class="some" type="submit" id="submitButton"></input>
</div>
</form>
<div class="text-center">
  {{#unless nova}}
    <button id="submitAlterations" align="center" class="btn btn-outline-success">Salvar alerações</button>
  {{/unless}}

  {{#if nova}}
    <button id="submitAlterations" align="center" class="btn btn-outline-danger mr-5">Salvar alerações sem aprovar
      requisição</button>

    <button id="submitAproved" align="center" class="btn btn-outline-success">Aprovar requisição</button>
  {{/if}}
</div>

<script>
  //SetCheckbox selected
  $(document).ready(function () {
    if ($('[id="{{requisition.destination}}"]').length)
      $('[id="{{requisition.destination}}"]').prop("checked", true);
    else {
      $('#Outros').prop("checked", true);
      $('#Outros').val("{{requisition.destination}}");
      $('#OtherInput').val("{{requisition.destination}}");
      $('#Other-destination').removeClass('form-disabled');
    }

    //Set select values
    let userstate = "{{requisition.address.state}}";
    $('select#userstate').val(userstate);

    let reqstate = "{{requisition.state}}";
    $('select#requisitonstate').val(reqstate);

    let reqdestination = "{{requisition.destination}}";
    $('select#requisitondestination').val(reqdestination);
  });

  $("#submitAlterations").click(function () {
    $("#submitButton").trigger("click");
  });

  $("#submitAproved").click(function () {
    $('#toApprove').prop("checked", true);
    $("#submitButton").trigger("click");
  });

  $('.destination').change(function () {
    if ($('#Outros').is(':checked')) {
      $('#Other-destination').removeClass('form-disabled');
    } else {
      $('#Other-destination').addClass('form-disabled');
    }
  });

  $("#Other-destination").keyup(function () {
    $('#Outros').val($(this).find('input').val());
  });
</script>
<script src="/javascripts/dynamicPlaceHolder.js" />